### Copyright (c) 2025 Red Hat, Inc.
### This program and the accompanying materials are made
### available under the terms of the Eclipse Public License 2.0
### which is available at https://www.eclipse.org/legal/epl-2.0/
###
### SPDX-License-Identifier: EPL-2.0
###
### Contributors:
###   Red Hat, Inc. - initial API and implementation
###
### che-server example requests (VS Code REST Client / IntelliJ HTTP Client)
###
### Local testing:
### - Start server: ./run/start-local-dev.sh
### - For auth in local mode you can use the "test Bearer" format supported by che-server:
###     Authorization: Bearer <userid>:<username>
### - Namespace endpoints also require USER_TOKEN for local runs:
###     export USER_TOKEN="$(oc whoami -t)"

@baseUrl = http://localhost:8080/api
@username = johndoe
@userid = user123
@bearer = {{userid}}:{{username}}
### For real OpenShift user token testing: paste `oc whoami -t` output into a variable and use:
###   Authorization: Bearer {{realToken}}
### (Command substitution $(...) is not supported in .http files.)

### Provision Namespace (Bearer Token)
POST {{baseUrl}}/kubernetes/namespace/provision
Authorization: Bearer {{bearer}}
Content-Type: application/json

### List Namespaces
GET {{baseUrl}}/kubernetes/namespace
Authorization: Bearer {{bearer}}

### Provision for Different User
POST {{baseUrl}}/kubernetes/namespace/provision
Authorization: Bearer user456:janedoe
Content-Type: application/json

### Test Unauthorized Request (should fail)
POST {{baseUrl}}/kubernetes/namespace/provision
Content-Type: application/json

### Resolve Factory from URL
POST {{baseUrl}}/factory/resolver
Authorization: Bearer {{bearer}}
Content-Type: application/json

{
  "url": "https://raw.githubusercontent.com/eclipse/che/main/devfile.yaml"
}

### Resolve Factory with Validation
POST {{baseUrl}}/factory/resolver?validate=true
Authorization: Bearer {{bearer}}
Content-Type: application/json

{
  "url": "https://example.com/devfile.yaml"
}

### Refresh Factory Token
POST {{baseUrl}}/factory/token/refresh?url=https://github.com/user/repo
Authorization: Bearer {{bearer}}
Content-Type: application/json

### System State
GET {{baseUrl}}/system/state

### Resolve Factory without Parameters (should fail)
POST {{baseUrl}}/factory/resolver
Authorization: Bearer {{bearer}}
Content-Type: application/json

{}

### Test Invalid Route (should return 404)
GET {{baseUrl}}/invalid/route
Authorization: Bearer {{userid}}:{{username}}

